# Technical Context

## Technologies used
1. **Frontend**:
   - React 18+ (JavaScript library for building user interfaces)
   - Bootstrap 5 (CSS framework for responsive design)
   - React Bootstrap (React components implementing Bootstrap)
   - React Bootstrap Icons (Icon library)
   - Vite (Build tool and development server)
   - JSZip (Library for creating ZIP files in the browser)
   - File-Saver (Library for saving files from the browser)
   - Axios (HTTP client for API requests, though currently using fetch API)

2. **State Management**:
   - React Hooks (useState for local state management)
   - Prop drilling for component communication
   - Centralized state in App.jsx

3. **Styling**:
   - CSS3 with custom properties (variables)
   - Bootstrap grid system and components
   - Media queries for responsive design
   - Custom panel-based UI system

4. **Backend**:
   - Azure Functions (serverless compute service)
   - Azure Blob Storage (for image storage)
   - Node.js with JavaScript
   - Sharp library for image processing
   - Azure Storage SDK (@azure/storage-blob)
   - Azure Identity SDK (@azure/identity) - (No longer primary for auth in this simplified version)
   - Function-generated SAS token authentication for blob storage (using connection strings).

## Development setup
1. **Project Structure**:
   - `/frontend`: Contains the React application (deployed to Azure Static Web Apps).
     - `/src`: Source code
       - `/components`: React components
       - `/services`: Service modules for API interactions
       - `/assets`: Static assets like images
     - `/public`: Public static files
     - `vite.config.js`: Vite configuration including API proxy settings for local development.
     - `package.json`: Frontend dependencies.
   - `/api`: Contains the single Azure Function (integrated with Azure Static Web Apps).
     - `/ProcessImage` (or similar consolidated name): Single function for SAS generation and image processing.
       - `function.json`: Function bindings configuration.
       - `index.js`: Function implementation.
     - `host.json`: Azure Functions host configuration (relevant for local testing and SWA).
     - `package.json`: Node.js dependencies for the function.
   - `/infrastructure`: Contains Bicep templates for Azure resources (SWA, Storage Account).
   - `/cline_docs`: Project documentation.
   - `.github/workflows`: GitHub Actions for CI/CD.

2. **Build System**:
   - Vite for frontend development and optimized production builds (output to `frontend/dist`).
   - Azure Functions Core Tools for local function development and testing (or SWA CLI for local emulation).
   - NPM for package management
   - ESLint for code linting

3. **Development Workflow**:
   - Local development server (Vite) with hot module replacement for frontend.
   - Local Azure Functions runtime (Azure Functions Core Tools or SWA CLI) for backend testing.
   - Azure Static Web Apps GitHub Action for CI/CD.
   - Proxy configuration in Vite to route `/api/*` requests during local development.
   - Authentication: Uses Azure Storage connection string for SAS token generation in both local (via `local.settings.json` or SWA CLI config) and deployed environments (via SWA app settings).

4. **Deployment**:
   - **Frontend & Backend API**: Deployed together via Azure Static Web Apps GitHub Action.
     - Frontend source: `/frontend`
     - API source: `/api`
     - Frontend build output: `frontend/dist`
   - **Infrastructure**: Deployed via GitHub Actions using Bicep templates (`/infrastructure/main.bicep`).
   - **Storage**: Azure Blob Storage with `uploads` and `downloads` containers.

## Technical constraints
1. **Browser Compatibility**:
   - Modern browsers (Chrome, Firefox, Safari, Edge)
   - Responsive design for desktop and mobile devices

2. **Performance Considerations**:
   - Image processing is resource-intensive
   - Azure Functions (managed by SWA) have execution time limits.
   - Blob storage operations may have latency.
   - UI should remain responsive during processing operations.
   - Large images may require additional processing time.

3. **Azure Functions (Integrated with SWA) Requirements**:
   - The function code resides in the folder specified as `api_location` (e.g., `/api`).
   - Each function within that folder (here, one consolidated function) must have its `function.json` and `index.js`.
   - `host.json` in the `api_location` root is used.
   - Proper HTTP trigger bindings required.
   - Anonymous authentication used for API endpoints.
   - Azure Storage access via connection string stored in SWA application settings.

4. **Limitations**:
   - Maximum image size: 20MB (as indicated in the UI).
   - Supported image formats: PNG, JPEG, GIF, BMP, TIFF, WebP
   - Currently no user authentication or persistent storage
   - SAS tokens generated by the function have a 1-hour validity period.
   - Predefined output formats with fixed dimensions.

5. **API Endpoints**:
   - `/api/ProcessImage` (or similar, e.g., `/api/ImageProcessor` if function folder is named that):
     - **GET** with `?action=getUploadSas&filename=<filename>`: For generating SAS tokens for uploads.
       - Returns: `{ uploadUrl: string, blobName: string }`
     - **POST** with `?action=processImage`: For processing images.
       - Request body: JSON with `{ sourceBlobName: string, formats: object }`
       - Returns: `{ processedImages: Array<{ name: string, url: string, size: string, dimensions: object }> }` (URLs are direct public links to 'downloads' container).

6. **Error Handling**:
   - Frontend: Try/catch blocks with error messages displayed to user.
   - Backend: Try/catch with structured error responses
   - HTTP status codes for different error types
   - Detailed error messages for debugging

7. **Data Flow**:
   - User uploads image to browser
   - Frontend calls Azure Function with `action=getUploadSas` to get an upload SAS URL and blob name.
   - Frontend uploads image directly to Azure Blob Storage (`uploads` container) using the SAS URL.
   - Frontend calls Azure Function with `action=processImage` and the `sourceBlobName`.
   - Backend Azure Function processes the image, stores results in the `downloads` container.
   - Backend returns direct public URLs for processed images.
   - Frontend downloads processed images (e.g., for zipping) using these public URLs.
   - ZIP file is offered for download to user.
